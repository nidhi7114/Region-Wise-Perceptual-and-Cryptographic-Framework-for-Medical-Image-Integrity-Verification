<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .match { background-color: #d4edda; font-weight: bold; }
        .mismatch { background-color: #f8d7da; font-weight: bold; }
        .signature-box { word-wrap: break-word; font-family: monospace; background: #f1f1f1; padding: 10px; border-radius: 5px; }
        .region-table td { width: 33%; text-align: center; vertical-align: middle; }
        .image-container img { max-height: 300px; object-fit: contain; }
    </style>
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="mb-4">{{ title }}</h2>

    <div class="row image-container">
        <div class="col-md-6">
            <h5>Uploaded Image:</h5>
            <img src="{{ url_for('uploaded_file', filename=uploaded) }}" class="img-fluid border" alt="Uploaded Image">
        </div>
        {% if mode == 'verify' and reference %}
        <div class="col-md-6">
            <h5>Reference Image:</h5>
            <img src="{{ url_for('uploaded_file', filename=reference) }}" class="img-fluid border" alt="Reference Image">
        </div>
        {% endif %}
    </div>

    {% if hash_value %}
    <div class="mt-4">
        <h5>Perceptual Hash:</h5>
        <div class="signature-box">{{ hash_value }}</div>
    </div>
    {% endif %}

    {% if signature_b64 %}
    <div class="mt-3">
        <h5>Signature (Base64):</h5>
        <div class="signature-box">{{ signature_b64 }}</div>
    </div>
    {% endif %}

    {% if tampered is not none %}
    <div class="mt-3">
        <h5>Status:</h5>
        {% if tampered %}
            <span class="text-danger fw-bold fs-5">❌ Tampered</span>
        {% else %}
            <span class="text-success fw-bold fs-5">✅ Untampered</span>
        {% endif %}
    </div>
    {% endif %}

    {% if hamming is not none %}
    <div class="mt-2">
        <h5>Hamming Distance:</h5>
        <p>{{ hamming }} (lower is better)</p>
    </div>
    {% endif %}

    {% if region_status %}
    <div class="mt-4">
        <h5>Region Grid (3×3):</h5>
        <table class="table table-bordered region-table">
            {% for i in range(0, region_status|length, 3) %}
            <tr>
                {% for j in range(3) %}
                    {% set idx = i + j %}
                    {% if idx < region_status|length %}
                        {% set r_hash, status = region_status[idx] %}
                        <td class="{{ status }}">
                            {{ status|capitalize }}<br>
                            <small>{{ r_hash[:8] }}…</small>
                        </td>
                    {% else %}
                        <td></td>
                    {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
    </div>
    {% endif %}

    <div class="mt-4">
        <a href="{{ url_for('uploaded_file', filename=uploaded) }}" class="btn btn-outline-secondary">Download Image</a>
        {% if mode == 'verify' %}
        <a href="{{ url_for('index') }}" class="btn btn-outline-info">Verify Another</a>
        {% endif %}
        <a href="{{ url_for('index') }}" class="btn btn-primary">Back to Home</a>
    </div>

    <div class="mt-4 text-muted">
        <small>Action: {{ mode|capitalize }} | Verified by: Admin | Timestamp: {{ timestamp }}</small>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
